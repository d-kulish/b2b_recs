{% load static %}
<!--
    Deploy Wizard Modal Component

    A configurable modal for deploying models to Cloud Run with preset configurations.

    Usage:
        { % include 'includes/_deploy_wizard.html' % }

    Required CSS:
        <link rel="stylesheet" href="{ % static 'css/deploy_wizard.css' % }?v=1">
        <link rel="stylesheet" href="{ % static 'css/modals.css' % }?v=1">

    Required JavaScript:
        <script src="{ % static 'js/deploy_wizard.js' % }?v=1"></script>

    JavaScript API:
        - DeployWizard.configure({ onSuccess: ... }) - Configure callbacks
        - DeployWizard.open(runId) - Open wizard for a training run
        - DeployWizard.close() - Close the wizard
        - DeployWizard.selectPreset(presetName) - Select a deployment preset
        - DeployWizard.toggleAdvanced() - Toggle advanced options visibility
        - DeployWizard.deploy() - Submit deployment
-->

<!-- Deploy Wizard Modal -->
<div id="deployWizardModal" class="modal-overlay hidden" onclick="DeployWizard.handleOverlayClick(event)">
    <div class="modal-container deploy-wizard-modal" onclick="event.stopPropagation()">
        <!-- Header -->
        <div class="modal-header deploy-wizard-header">
            <div class="deploy-wizard-header-icon">
                <i class="fas fa-cloud-upload-alt"></i>
            </div>
            <div class="deploy-wizard-header-text">
                <h3 class="deploy-wizard-title">Deploy to Cloud Run</h3>
                <p class="deploy-wizard-subtitle" id="deployWizardSubtitle">Configure deployment settings</p>
            </div>
            <button class="deploy-wizard-close" onclick="DeployWizard.close()" title="Close">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <!-- Body -->
        <div class="modal-body deploy-wizard-body">
            <!-- Model Info Card -->
            <div class="deploy-model-info-card" id="deployModelInfoCard">
                <div class="deploy-model-info-item">
                    <div class="deploy-model-info-label">Model</div>
                    <div class="deploy-model-info-value" id="deployModelName">-</div>
                </div>
                <div class="deploy-model-info-item">
                    <div class="deploy-model-info-label">Training Run</div>
                    <div class="deploy-model-info-value" id="deployRunId">-</div>
                </div>
            </div>

            <!-- Deployment Preset Section -->
            <div class="deploy-section-title">Deployment Preset</div>
            <div class="deploy-preset-cards">
                <!-- Development Preset -->
                <div class="deploy-preset-card" data-preset="development" onclick="DeployWizard.selectPreset('development')">
                    <div class="deploy-preset-name">Development</div>
                    <div class="deploy-preset-specs">
                        <strong>0-2</strong> instances
                    </div>
                    <div class="deploy-preset-specs">
                        <strong>2Gi</strong> / <strong>1</strong> CPU
                    </div>
                    <div class="deploy-preset-use-case">Testing, low traffic</div>
                </div>

                <!-- Production Preset -->
                <div class="deploy-preset-card selected" data-preset="production" onclick="DeployWizard.selectPreset('production')">
                    <div class="deploy-preset-recommended">Recommended</div>
                    <div class="deploy-preset-name">Production</div>
                    <div class="deploy-preset-specs">
                        <strong>1-10</strong> instances
                    </div>
                    <div class="deploy-preset-specs">
                        <strong>4Gi</strong> / <strong>2</strong> CPU
                    </div>
                    <div class="deploy-preset-use-case">Standard workload</div>
                </div>

                <!-- High Traffic Preset -->
                <div class="deploy-preset-card" data-preset="high_traffic" onclick="DeployWizard.selectPreset('high_traffic')">
                    <div class="deploy-preset-name">High Traffic</div>
                    <div class="deploy-preset-specs">
                        <strong>2-50</strong> instances
                    </div>
                    <div class="deploy-preset-specs">
                        <strong>8Gi</strong> / <strong>4</strong> CPU
                    </div>
                    <div class="deploy-preset-use-case">High concurrency</div>
                </div>
            </div>

            <!-- Advanced Options Toggle -->
            <div class="deploy-advanced-toggle" id="deployAdvancedToggle" onclick="DeployWizard.toggleAdvanced()">
                <i class="fas fa-cog"></i>
                <span class="deploy-advanced-toggle-text">Advanced Options</span>
                <i class="fas fa-chevron-right deploy-advanced-toggle-chevron"></i>
            </div>

            <!-- Advanced Options Panel (collapsed by default) -->
            <div class="deploy-advanced-options" id="deployAdvancedOptions">
                <div class="deploy-options-grid">
                    <div class="deploy-option-field">
                        <label class="deploy-option-label" for="deployMinInstances">Min Instances</label>
                        <input type="number" id="deployMinInstances" class="deploy-option-input"
                               min="0" max="100" value="1"
                               onchange="DeployWizard.updateConfig('min_instances', this.value)">
                    </div>
                    <div class="deploy-option-field">
                        <label class="deploy-option-label" for="deployMaxInstances">Max Instances</label>
                        <input type="number" id="deployMaxInstances" class="deploy-option-input"
                               min="1" max="100" value="10"
                               onchange="DeployWizard.updateConfig('max_instances', this.value)">
                    </div>
                    <div class="deploy-option-field">
                        <label class="deploy-option-label" for="deployMemory">Memory</label>
                        <select id="deployMemory" class="deploy-option-select"
                                onchange="DeployWizard.updateConfig('memory', this.value)">
                            <option value="1Gi">1 Gi</option>
                            <option value="2Gi">2 Gi</option>
                            <option value="4Gi" selected>4 Gi</option>
                            <option value="8Gi">8 Gi</option>
                            <option value="16Gi">16 Gi</option>
                        </select>
                    </div>
                    <div class="deploy-option-field">
                        <label class="deploy-option-label" for="deployCpu">CPU</label>
                        <select id="deployCpu" class="deploy-option-select"
                                onchange="DeployWizard.updateConfig('cpu', this.value)">
                            <option value="1">1 vCPU</option>
                            <option value="2" selected>2 vCPU</option>
                            <option value="4">4 vCPU</option>
                            <option value="8">8 vCPU</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Configuration Summary -->
            <div class="deploy-config-summary" id="deployConfigSummary">
                <div class="deploy-config-summary-title">
                    <i class="fas fa-clipboard-check"></i> Configuration Summary
                </div>
                <div class="deploy-config-summary-grid">
                    <div class="deploy-config-summary-item">
                        <span class="deploy-config-summary-label">Instances:</span>
                        <span class="deploy-config-summary-value" id="deploySummaryInstances">1-10</span>
                    </div>
                    <div class="deploy-config-summary-separator"></div>
                    <div class="deploy-config-summary-item">
                        <span class="deploy-config-summary-label">Memory:</span>
                        <span class="deploy-config-summary-value" id="deploySummaryMemory">4Gi</span>
                    </div>
                    <div class="deploy-config-summary-separator"></div>
                    <div class="deploy-config-summary-item">
                        <span class="deploy-config-summary-label">CPU:</span>
                        <span class="deploy-config-summary-value" id="deploySummaryCpu">2 vCPU</span>
                    </div>
                    <div class="deploy-config-summary-separator"></div>
                    <div class="deploy-config-summary-item">
                        <span class="deploy-config-summary-label">Timeout:</span>
                        <span class="deploy-config-summary-value" id="deploySummaryTimeout">300s</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="modal-footer-wizard-neu">
            <div class="footer-left"></div>
            <div class="footer-right">
                <button class="btn-neu btn-neu-action btn-neu-save" id="deployWizardDeployBtn" onclick="DeployWizard.deploy()">
                    <span class="btn-neu-inner"><i class="fas fa-rocket" style="margin-right: 6px;"></i>Deploy</span>
                </button>
                <button class="btn-neu btn-neu-action btn-neu-cancel" onclick="DeployWizard.close()">
                    <span class="btn-neu-inner">Cancel</span>
                </button>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div class="deploy-wizard-loading hidden" id="deployWizardLoading">
            <div class="deploy-wizard-loading-content">
                <i class="fas fa-spinner fa-spin"></i>
                <span>Deploying to Cloud Run...</span>
            </div>
        </div>
    </div>
</div>
