{% load static %}
<!--
    Integrate Modal Component

    A modal for testing and integrating with deployed ML endpoints.
    Shows Quick Validation, Input Schema, and Code Examples.

    Usage:
        { % include 'includes/_integrate_modal.html' % }

    Required CSS:
        <link rel="stylesheet" href="{ % static 'css/integrate_modal.css' % }?v=2">

    Required JavaScript:
        <script src="{ % static 'js/integrate_modal.js' % }?v=2"></script>

    JavaScript API:
        - IntegrateModal.open(endpointId) - Open modal for an endpoint
        - IntegrateModal.close() - Close the modal
        - IntegrateModal.refreshSample() - Get new sample data
        - IntegrateModal.runPredictionTest() - Run prediction test
        - IntegrateModal.switchCodeTab(lang) - Switch code language
        - IntegrateModal.copyCode() - Copy code to clipboard
-->

<!-- Integrate Modal -->
<div id="integrateModal" class="modal-overlay hidden" onclick="IntegrateModal.handleOverlayClick(event)">
    <div class="modal-container integrate-modal" onclick="event.stopPropagation()">
        <!-- Header -->
        <div class="modal-header-soft soft-integrate" id="integrateHeader">
            <div class="modal-header-icon-badge"><i class="fas fa-plug"></i></div>
            <div style="flex: 1;">
                <h3 class="modal-header-title" id="integrateModalTitle">Endpoint Name</h3>
                <div class="modal-header-subtitle" id="integrateModalSubtitle">Endpoint integration</div>
            </div>
            <div class="modal-header-status-circle" id="integrateStatusCircle" style="background: #16a34a;">
                <i class="fas fa-check"></i>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="exp-view-nav-bar exp-nav-integrate" id="integrateNavBar">
            <div class="exp-view-nav-pills">
                <button class="exp-view-pill current" data-tab="validation" onclick="IntegrateModal.switchTab('validation')">Validation</button>
                <button class="exp-view-pill" data-tab="code" onclick="IntegrateModal.switchTab('code')">Code Examples</button>
            </div>
        </div>

        <!-- Tab Content -->
        <div class="modal-body exp-view-body">
            <!-- Validation Tab -->
            <div id="integrateTabValidation" class="exp-view-tab-content active">
                <!-- Input Schema Card (collapsible) -->
                <div class="component-logs-card" id="integrateSchemaCard" style="margin-bottom: 16px;">
                    <div class="component-logs-card-header" onclick="IntegrateModal.toggleSchema()">
                        <div class="component-logs-card-header-left">
                            <div class="component-logs-card-icon" style="background: linear-gradient(135deg, #3b82f6, #60a5fa);">
                                <i class="fas fa-table"></i>
                            </div>
                            <div class="component-logs-card-title">Input Schema</div>
                        </div>
                        <div class="component-logs-card-actions">
                            <div class="component-logs-card-toggle">
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                    </div>
                    <div class="component-logs-card-content">
                        <div class="component-logs-card-divider"></div>
                        <div class="integrate-schema-table-container">
                            <table class="integrate-schema-table">
                                <thead>
                                    <tr>
                                        <th>Field</th>
                                        <th>Type</th>
                                        <th>Notes</th>
                                    </tr>
                                </thead>
                                <tbody id="integrateSchemaBody">
                                    <tr>
                                        <td colspan="3" class="integrate-loading">
                                            <i class="fas fa-spinner fa-spin"></i> Loading schema...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Sample Test Card (collapsible) -->
                <div class="component-logs-card logs-open" id="integrateSampleTestCard">
                    <div class="component-logs-card-header" onclick="IntegrateModal.toggleSampleTest()">
                        <div class="component-logs-card-header-left">
                            <div class="component-logs-card-icon" style="background: linear-gradient(135deg, #10b981, #34d399);">
                                <i class="fas fa-flask"></i>
                            </div>
                            <div class="component-logs-card-title">Sample Test</div>
                        </div>
                        <!-- Mode toggle (Single/Batch) â€” centered -->
                        <div class="btn-group-tight" id="integrateModeToggle" onclick="event.stopPropagation();">
                            <button class="btn btn-sm btn-secondary integrate-mode-btn active" data-mode="single"
                                    style="min-width: 130px; padding: 10px 30px;"
                                    onclick="IntegrateModal.switchTestMode('single')">
                                <i class="fas fa-user"></i> Single
                            </button>
                            <button class="btn btn-sm btn-secondary integrate-mode-btn" data-mode="batch"
                                    style="min-width: 130px; padding: 10px 30px;"
                                    onclick="IntegrateModal.switchTestMode('batch')">
                                <i class="fas fa-users"></i> Batch
                            </button>
                        </div>
                        <div class="component-logs-card-actions">
                            <!-- Update & Predict buttons -->
                            <button class="card-action-btn schedule" style="width: 100px;" onclick="event.stopPropagation(); IntegrateModal.refreshSample()" id="integrateUpdateBtn">
                                <i class="fas fa-sync-alt" id="integrateSampleRefreshIcon"></i>
                                Update
                            </button>
                            <button class="card-action-btn view" style="width: 100px;" onclick="event.stopPropagation(); IntegrateModal.runPredictionTest()" id="integratePredictBtn">
                                <i class="fas fa-play" id="integratePredictIcon"></i>
                                Predict
                            </button>
                            <div class="component-logs-card-toggle">
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                    </div>
                    <div class="component-logs-card-content">
                        <div class="component-logs-card-divider"></div>
                        <!-- Sample Request -->
                        <div class="integrate-validation-row integrate-validation-row-expanded">
                            <div class="integrate-validation-label">
                                <span class="integrate-label-text">Sample Request</span>
                            </div>
                            <pre class="sql-code-light" id="integrateSampleData">{"loading": "..."}</pre>
                        </div>

                        <!-- Prediction Response -->
                        <div class="integrate-validation-row integrate-validation-row-expanded" id="integratePredictResultRow" style="display: none;">
                            <div class="integrate-validation-label">
                                <span class="integrate-label-text">Response</span>
                            </div>
                            <pre class="sql-code-light" id="integratePredictResult"></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Code Examples Tab -->
            <div id="integrateTabCode" class="exp-view-tab-content">
                <div class="component-logs-card logs-open" id="integrateCodeExamplesCard">
                    <div class="component-logs-card-header" onclick="IntegrateModal.toggleCodeExamples()">
                        <div class="component-logs-card-header-left">
                            <div class="component-logs-card-icon" style="background: linear-gradient(135deg, #6366f1, #818cf8);">
                                <i class="fas fa-code"></i>
                            </div>
                            <div class="component-logs-card-title">Code Examples</div>
                        </div>
                        <!-- Mode toggle (Single/Batch) -->
                        <div class="btn-group-tight" id="integrateCodeModeToggle" onclick="event.stopPropagation();">
                            <button class="btn btn-sm btn-secondary integrate-mode-btn active" data-mode="single"
                                    style="min-width: 130px; padding: 10px 30px;"
                                    onclick="IntegrateModal.switchTestMode('single')">
                                <i class="fas fa-user"></i> Single
                            </button>
                            <button class="btn btn-sm btn-secondary integrate-mode-btn" data-mode="batch"
                                    style="min-width: 130px; padding: 10px 30px;"
                                    onclick="IntegrateModal.switchTestMode('batch')">
                                <i class="fas fa-users"></i> Batch
                            </button>
                        </div>
                        <div class="component-logs-card-actions">
                            <div class="component-logs-card-toggle">
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                    </div>
                    <div class="component-logs-card-content">
                        <div class="component-logs-card-divider"></div>
                        <!-- Language Tabs -->
                        <div class="integrate-code-tabs">
                            <button class="integrate-code-tab active" data-lang="python" onclick="IntegrateModal.switchCodeTab('python')">
                                Python
                            </button>
                            <button class="integrate-code-tab" data-lang="javascript" onclick="IntegrateModal.switchCodeTab('javascript')">
                                JavaScript
                            </button>
                            <button class="integrate-code-tab" data-lang="curl" onclick="IntegrateModal.switchCodeTab('curl')">
                                cURL
                            </button>
                            <button class="integrate-code-tab" data-lang="java" onclick="IntegrateModal.switchCodeTab('java')">
                                Java
                            </button>
                        </div>

                        <!-- Code Display -->
                        <pre class="sql-code-light" id="integrateCodeDisplay">Loading...</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="modal-footer-wizard-neu">
            <div class="footer-left"></div>
            <div class="footer-right">
                <button type="button" class="btn-neu btn-neu-action btn-neu-save" onclick="IntegrateModal.copyCode()" id="integrateCopyCodeBtn">
                    <span class="btn-neu-inner" id="integrateCopyText">Copy</span>
                </button>
                <button type="button" class="btn-neu btn-neu-action btn-neu-cancel" onclick="IntegrateModal.close()">
                    <span class="btn-neu-inner">Close</span>
                </button>
            </div>
        </div>
    </div>
</div>
