{% load static %}
<!--
    Integrate Modal Component

    A modal for testing and integrating with deployed ML endpoints.
    Shows Quick Validation, Input Schema, and Code Examples.

    Usage:
        { % include 'includes/_integrate_modal.html' % }

    Required CSS:
        <link rel="stylesheet" href="{ % static 'css/integrate_modal.css' % }?v=2">

    Required JavaScript:
        <script src="{ % static 'js/integrate_modal.js' % }?v=2"></script>

    JavaScript API:
        - IntegrateModal.open(endpointId) - Open modal for an endpoint
        - IntegrateModal.close() - Close the modal
        - IntegrateModal.refreshSample() - Get new sample data
        - IntegrateModal.runPredictionTest() - Run prediction test
        - IntegrateModal.switchCodeTab(lang) - Switch code language
        - IntegrateModal.copyCode() - Copy code to clipboard
-->

<!-- Integrate Modal -->
<div id="integrateModal" class="modal-overlay hidden" onclick="IntegrateModal.handleOverlayClick(event)">
    <div class="modal-container integrate-modal" onclick="event.stopPropagation()">
        <!-- Header -->
        <div class="modal-header-soft soft-integrate" id="integrateHeader">
            <div class="modal-header-icon-badge"><i class="fas fa-plug"></i></div>
            <div style="flex: 1;">
                <h3 class="modal-header-title" id="integrateModalTitle">Endpoint Name</h3>
                <div class="modal-header-subtitle" id="integrateModalSubtitle">Endpoint integration</div>
            </div>
            <div class="modal-header-status-circle" id="integrateStatusCircle" style="background: #16a34a;">
                <i class="fas fa-check"></i>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="exp-view-nav-bar exp-nav-integrate" id="integrateNavBar">
            <div class="exp-view-nav-pills">
                <button class="exp-view-pill current" data-tab="validation" onclick="IntegrateModal.switchTab('validation')">Validation</button>
                <button class="exp-view-pill" data-tab="code" onclick="IntegrateModal.switchTab('code')">Code Examples</button>
            </div>
        </div>

        <!-- Tab Content -->
        <div class="modal-body exp-view-body">
            <!-- Validation Tab -->
            <div id="integrateTabValidation" class="exp-view-tab-content active">
                <!-- Input Schema Card -->
                <div class="exp-detail-section" style="margin-bottom: 16px;">
                    <div class="exp-detail-section-title">Input Schema</div>
                    <div class="exp-detail-section-body" style="align-items: flex-start;">
                        <div class="exp-detail-section-icon info"><i class="fas fa-table"></i></div>
                        <div style="flex: 1;">
                            <div class="integrate-schema-table-container">
                                <table class="integrate-schema-table">
                                    <thead>
                                        <tr>
                                            <th>Field</th>
                                            <th>Type</th>
                                            <th>Notes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="integrateSchemaBody">
                                        <tr>
                                            <td colspan="3" class="integrate-loading">
                                                <i class="fas fa-spinner fa-spin"></i> Loading schema...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sample Test Card (collapsible) -->
                <div class="component-logs-card logs-open" id="integrateSampleTestCard">
                    <div class="component-logs-card-header" onclick="IntegrateModal.toggleSampleTest()">
                        <div class="component-logs-card-header-left">
                            <div class="component-logs-card-icon" style="background: linear-gradient(135deg, #10b981, #34d399);">
                                <i class="fas fa-flask"></i>
                            </div>
                            <div class="component-logs-card-title">Sample Test</div>
                        </div>
                        <div class="component-logs-card-actions">
                            <!-- Mode toggle (Single/Batch) -->
                            <div class="integrate-mode-toggle" id="integrateModeToggle" style="width: auto; margin-bottom: 0; border: 1px solid #e5e7eb;" onclick="event.stopPropagation();">
                                <button class="integrate-mode-btn active" data-mode="single"
                                        onclick="IntegrateModal.switchTestMode('single')">
                                    <i class="fas fa-user"></i> Single
                                </button>
                                <button class="integrate-mode-btn" data-mode="batch"
                                        onclick="IntegrateModal.switchTestMode('batch')">
                                    <i class="fas fa-layer-group"></i> Batch
                                </button>
                            </div>
                            <!-- Update & Predict buttons -->
                            <button class="integrate-action-btn integrate-action-btn-blue" onclick="event.stopPropagation(); IntegrateModal.refreshSample()" id="integrateUpdateBtn">
                                <i class="fas fa-sync-alt" id="integrateSampleRefreshIcon"></i>
                                <span>Update</span>
                            </button>
                            <button class="integrate-action-btn integrate-action-btn-green" onclick="event.stopPropagation(); IntegrateModal.runPredictionTest()" id="integratePredictBtn">
                                <i class="fas fa-play" id="integratePredictIcon"></i>
                                <span>Predict</span>
                            </button>
                            <div class="component-logs-card-toggle">
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                    </div>
                    <div class="component-logs-card-content">
                        <div class="component-logs-card-divider"></div>
                        <!-- Sample Request -->
                        <div class="integrate-validation-row integrate-validation-row-expanded">
                            <div class="integrate-validation-label">
                                <span class="integrate-label-text">Sample Request</span>
                            </div>
                            <div class="integrate-sample-box">
                                <pre class="integrate-sample-code" id="integrateSampleData">{"loading": "..."}</pre>
                            </div>
                        </div>

                        <!-- Prediction Response -->
                        <div class="integrate-validation-row integrate-validation-row-expanded" id="integratePredictResultRow" style="display: none;">
                            <div class="integrate-validation-label">
                                <span class="integrate-label-text">Response</span>
                            </div>
                            <div class="integrate-sample-box">
                                <pre class="integrate-sample-code" id="integratePredictResult"></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Code Examples Tab -->
            <div id="integrateTabCode" class="exp-view-tab-content">
                <div class="exp-detail-section">
                    <div class="exp-detail-section-title">Code Examples</div>
                    <div class="exp-detail-section-body" style="align-items: flex-start;">
                        <div class="exp-detail-section-icon url"><i class="fas fa-code"></i></div>
                        <div style="flex: 1;">
                            <!-- Mode Toggle (Single/Batch) -->
                            <div class="integrate-mode-toggle" id="integrateCodeModeToggle">
                                <button class="integrate-mode-btn active" data-mode="single"
                                        onclick="IntegrateModal.switchTestMode('single')">
                                    <i class="fas fa-user"></i> Single
                                </button>
                                <button class="integrate-mode-btn" data-mode="batch"
                                        onclick="IntegrateModal.switchTestMode('batch')">
                                    <i class="fas fa-layer-group"></i> Batch
                                </button>
                            </div>

                            <!-- Language Tabs -->
                            <div class="integrate-code-tabs">
                                <button class="integrate-code-tab active" data-lang="python" onclick="IntegrateModal.switchCodeTab('python')">
                                    Python
                                </button>
                                <button class="integrate-code-tab" data-lang="javascript" onclick="IntegrateModal.switchCodeTab('javascript')">
                                    JavaScript
                                </button>
                                <button class="integrate-code-tab" data-lang="curl" onclick="IntegrateModal.switchCodeTab('curl')">
                                    cURL
                                </button>
                                <button class="integrate-code-tab" data-lang="java" onclick="IntegrateModal.switchCodeTab('java')">
                                    Java
                                </button>
                            </div>

                            <!-- Code Display -->
                            <div class="integrate-code-container">
                                <button class="integrate-copy-btn" onclick="IntegrateModal.copyCode()" title="Copy to clipboard">
                                    <i class="fas fa-copy" id="integrateCopyIcon"></i>
                                    <span id="integrateCopyText">Copy</span>
                                </button>
                                <pre class="integrate-code-block"><code id="integrateCodeDisplay" class="language-python">Loading...</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="modal-footer-wizard-neu">
            <div class="footer-left"></div>
            <div class="footer-right">
                <button type="button" class="btn-neu btn-neu-action btn-neu-cancel" onclick="IntegrateModal.close()">
                    <span class="btn-neu-inner">Close</span>
                </button>
            </div>
        </div>
    </div>
</div>
