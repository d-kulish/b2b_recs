{% load static %}
<!--
    Integrate Modal Component

    A modal for testing and integrating with deployed ML endpoints.
    Shows Quick Validation, Input Schema, and Code Examples.

    Usage:
        { % include 'includes/_integrate_modal.html' % }

    Required CSS:
        <link rel="stylesheet" href="{ % static 'css/integrate_modal.css' % }?v=1">

    Required JavaScript:
        <script src="{ % static 'js/integrate_modal.js' % }?v=1"></script>

    JavaScript API:
        - IntegrateModal.open(endpointId) - Open modal for an endpoint
        - IntegrateModal.close() - Close the modal
        - IntegrateModal.refreshSample() - Get new sample data
        - IntegrateModal.runHealthCheck() - Run health check
        - IntegrateModal.runPredictionTest() - Run prediction test
        - IntegrateModal.switchCodeTab(lang) - Switch code language
        - IntegrateModal.copyCode() - Copy code to clipboard
-->

<!-- Integrate Modal -->
<div id="integrateModal" class="modal-overlay hidden" onclick="IntegrateModal.handleOverlayClick(event)">
    <div class="modal-container integrate-modal" onclick="event.stopPropagation()">
        <!-- Header -->
        <div class="integrate-modal-header">
            <div class="integrate-modal-header-content">
                <h3 class="integrate-modal-title" id="integrateModalTitle">Integrate</h3>
                <span class="integrate-modal-type-badge" id="integrateModalTypeBadge"></span>
            </div>
            <div class="integrate-modal-status-panel">
                <div class="integrate-modal-status-icon">
                    <i class="fas fa-plug"></i>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="integrate-tabs" id="integrateTabs">
            <button class="integrate-tab active" data-tab="validation" onclick="IntegrateModal.switchTab('validation')">
                Validation
            </button>
            <button class="integrate-tab" data-tab="code" onclick="IntegrateModal.switchTab('code')">
                Code Examples
            </button>
        </div>

        <!-- Tab Content -->
        <div class="integrate-modal-body">
            <!-- Validation Tab -->
            <div id="integrateTabValidation" class="integrate-tab-content active">
                <!-- Input Schema Accordion -->
                <div class="integrate-accordion">
                    <div class="integrate-accordion-header" onclick="IntegrateModal.toggleAccordion('schema')">
                        <span class="integrate-accordion-title">
                            <i class="fas fa-table integrate-icon-blue"></i>
                            Input Schema
                        </span>
                        <i id="integrateSchemaChevron" class="fas fa-chevron-right integrate-accordion-chevron"></i>
                    </div>
                    <div id="integrateSchemaContent" class="integrate-accordion-content hidden">
                        <div class="integrate-schema-table-container">
                            <table class="integrate-schema-table">
                                <thead>
                                    <tr>
                                        <th>Field</th>
                                        <th>Type</th>
                                        <th>Notes</th>
                                    </tr>
                                </thead>
                                <tbody id="integrateSchemaBody">
                                    <tr>
                                        <td colspan="3" class="integrate-loading">
                                            <i class="fas fa-spinner fa-spin"></i> Loading schema...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Sample Test Accordion -->
                <div class="integrate-accordion">
                    <div class="integrate-accordion-header" onclick="IntegrateModal.toggleAccordion('test')">
                        <span class="integrate-accordion-title">
                            <i class="fas fa-flask integrate-icon-green"></i>
                            Sample Test
                        </span>
                        <i id="integrateTestChevron" class="fas fa-chevron-right integrate-accordion-chevron expanded"></i>
                    </div>
                    <div id="integrateTestContent" class="integrate-accordion-content">
                        <!-- Mode Toggle (Single/Batch) -->
                        <div class="integrate-mode-toggle" id="integrateModeToggle">
                            <button class="integrate-mode-btn active" data-mode="single"
                                    onclick="IntegrateModal.switchTestMode('single')">
                                <i class="fas fa-user"></i> Single
                            </button>
                            <button class="integrate-mode-btn" data-mode="batch"
                                    onclick="IntegrateModal.switchTestMode('batch')">
                                <i class="fas fa-layer-group"></i> Batch
                            </button>
                        </div>

                        <!-- Sample Request Row -->
                        <div class="integrate-validation-row integrate-validation-row-expanded">
                            <div class="integrate-validation-label">
                                <span class="integrate-label-text">Sample Request</span>
                                <div class="integrate-label-actions">
                                    <button class="integrate-action-btn integrate-action-btn-blue" onclick="event.stopPropagation(); IntegrateModal.refreshSample()" id="integrateUpdateBtn">
                                        <i class="fas fa-sync-alt" id="integrateSampleRefreshIcon"></i>
                                        <span>Update</span>
                                    </button>
                                    <button class="integrate-action-btn integrate-action-btn-green" onclick="event.stopPropagation(); IntegrateModal.runPredictionTest()" id="integratePredictBtn">
                                        <i class="fas fa-play" id="integratePredictIcon"></i>
                                        <span>Predict</span>
                                    </button>
                                </div>
                            </div>
                            <div class="integrate-sample-box">
                                <pre class="integrate-sample-code" id="integrateSampleData">{"loading": "..."}</pre>
                            </div>
                        </div>

                        <!-- Prediction Response Row -->
                        <div class="integrate-validation-row integrate-validation-row-expanded" id="integratePredictResultRow" style="display: none;">
                            <div class="integrate-validation-label">
                                <span class="integrate-label-text">Response</span>
                            </div>
                            <div class="integrate-sample-box">
                                <pre class="integrate-sample-code" id="integratePredictResult"></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Code Examples Tab -->
            <div id="integrateTabCode" class="integrate-tab-content">
                <!-- Language Tabs -->
                <div class="integrate-code-tabs">
                    <button class="integrate-code-tab active" data-lang="python" onclick="IntegrateModal.switchCodeTab('python')">
                        Python
                    </button>
                    <button class="integrate-code-tab" data-lang="javascript" onclick="IntegrateModal.switchCodeTab('javascript')">
                        JavaScript
                    </button>
                    <button class="integrate-code-tab" data-lang="curl" onclick="IntegrateModal.switchCodeTab('curl')">
                        cURL
                    </button>
                    <button class="integrate-code-tab" data-lang="java" onclick="IntegrateModal.switchCodeTab('java')">
                        Java
                    </button>
                </div>

                <!-- Code Display -->
                <div class="integrate-code-container">
                    <button class="integrate-copy-btn" onclick="IntegrateModal.copyCode()" title="Copy to clipboard">
                        <i class="fas fa-copy" id="integrateCopyIcon"></i>
                        <span id="integrateCopyText">Copy</span>
                    </button>
                    <pre class="integrate-code-block"><code id="integrateCodeDisplay" class="language-python">Loading...</code></pre>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="modal-footer-wizard-neu">
            <div class="footer-left"></div>
            <div class="footer-right">
                <button type="button" class="btn-neu btn-neu-action btn-neu-cancel" onclick="IntegrateModal.close()">
                    <span class="btn-neu-inner">Close</span>
                </button>
            </div>
        </div>
    </div>
</div>
