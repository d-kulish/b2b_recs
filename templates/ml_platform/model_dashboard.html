{% extends 'base_model.html' %}
{% load static %}

{% block title %}{{ model.name }} - Dashboard{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/model_dashboard.css' %}?v=15">
<link rel="stylesheet" href="{% static 'css/cards.css' %}?v=4">
<link rel="stylesheet" href="{% static 'css/schedule_calendar.css' %}">
<link rel="stylesheet" href="{% static 'css/exp_view_modal.css' %}?v=3">
<link rel="stylesheet" href="{% static 'css/pipeline_dag.css' %}?v=1">
{% endblock %}

{% block model_content %}
<!-- CHAPTER: ENDPOINTS -->
<div id="endpointsChapter" class="bg-white rounded-xl border border-black shadow-lg p-6">
    <!-- Header -->
    <div class="flex items-center gap-4 mb-6">
        <div class="w-14 h-14 rounded-xl flex items-center justify-center shadow-sm" style="background: linear-gradient(135deg, #3b82f6, #60a5fa);">
            <i class="fas fa-chart-line text-white text-2xl"></i>
        </div>
        <div>
            <h2 class="text-2xl font-bold text-gray-900">Endpoints</h2>
            <p class="chapter-subtitle">Monitor serving performance and traffic</p>
        </div>
    </div>

    <!-- KPI Row (Summary Card + 4 Performance Cards) -->
    <div id="endpointsKpiRow" class="model-dashboard-kpi-row"></div>

    <!-- Charts Grid -->
    <div id="endpointsChartsGrid" class="model-dashboard-charts-grid"></div>

    <!-- Tables Section -->
    <div id="endpointsTablesSection" class="model-dashboard-tables-section"></div>
</div>

<!-- CHAPTER: MODELS -->
<div id="modelsChapter" class="bg-white rounded-xl border border-black shadow-lg p-6 mt-6">
    <!-- Header -->
    <div class="flex items-center gap-4 mb-6">
        <div class="w-14 h-14 rounded-xl flex items-center justify-center shadow-sm" style="background: linear-gradient(135deg, #8b5cf6, #a78bfa);">
            <i class="fas fa-cube text-white text-2xl"></i>
        </div>
        <div>
            <h2 class="text-2xl font-bold text-gray-900">Models</h2>
            <p class="chapter-subtitle">Track registered models and deployments</p>
        </div>
    </div>

    <!-- KPI Row (5 Cards) -->
    <div id="modelsChapterKpiRow" class="model-dashboard-models-kpi-row"></div>

    <!-- Training Activity Calendar -->
    <div class="model-dashboard-models-calendar-wrapper">
        <h4 class="model-dashboard-models-calendar-title">
            <i class="fas fa-calendar-alt"></i>
            Training Activity
        </h4>
        <div id="modelsChapterCalendar"></div>
    </div>

    <!-- Filter Bar -->
    <div id="modelsChapterFilterBar" class="model-dashboard-models-filter-bar"></div>

    <!-- Models Table -->
    <div id="modelsChapterTable"></div>

    <!-- Empty State -->
    <div id="modelsChapterEmptyState" class="model-dashboard-models-empty-state" style="display: none;"></div>
</div>

<!-- CHAPTER: EXPERIMENTS -->
<div id="experimentsChapter" class="bg-white rounded-xl border border-black shadow-lg p-6 mt-6">
    <!-- Header -->
    <div class="flex items-center gap-4 mb-6">
        <div class="w-14 h-14 rounded-xl flex items-center justify-center shadow-sm" style="background: linear-gradient(135deg, #10b981, #34d399);">
            <i class="fas fa-flask text-white text-2xl"></i>
        </div>
        <div>
            <h2 class="text-2xl font-bold text-gray-900">Experiments</h2>
            <p class="chapter-subtitle">Analyze experiment results and metrics</p>
        </div>
    </div>

    <!-- KPI Sections (40%) + Metrics Trend (60%) -->
    <div id="experimentsKpiTrendRow" class="model-dashboard-experiments-kpi-trend-row"></div>

    <!-- Top Configurations Table -->
    <div id="experimentsTopConfigsSection" class="model-dashboard-experiments-section"></div>
</div>

<!-- CHAPTER: CONFIGS -->
<div id="configsChapter" class="bg-white rounded-xl border border-black shadow-lg p-6 mt-6">
    <!-- Header -->
    <div class="flex items-center gap-4 mb-6">
        <div class="w-14 h-14 rounded-xl flex items-center justify-center shadow-sm" style="background: linear-gradient(135deg, #6366f1, #818cf8);">
            <i class="fas fa-cogs text-white text-2xl"></i>
        </div>
        <div>
            <h2 class="text-2xl font-bold text-gray-900">Configs</h2>
            <p class="chapter-subtitle">Track configuration inventory and usage</p>
        </div>
    </div>

    <!-- Loading State -->
    <div id="configsChapterLoading" class="model-dashboard-configs-loading">
        <i class="fas fa-spinner fa-spin text-2xl text-gray-400 mr-3"></i>
        <span class="text-gray-500">Loading configs...</span>
    </div>

    <!-- Empty State -->
    <div id="configsChapterEmpty" class="model-dashboard-configs-empty hidden">
        <i class="fas fa-cubes"></i>
        <p class="model-dashboard-configs-empty-title">No configurations yet</p>
        <p class="model-dashboard-configs-empty-text">Configuration data will appear here once datasets, features, and models are created.</p>
    </div>

    <!-- KPI Row (3 Cards: Datasets, Features, Models) -->
    <div id="configsChapterKpiRow" class="model-dashboard-configs-kpi-row hidden"></div>
</div>

<!-- CHAPTER: ETL -->
<div id="etlChapter" class="bg-white rounded-xl border border-black shadow-lg p-6 mt-6">
    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
        <div class="flex items-center gap-4">
            <div class="w-14 h-14 rounded-xl flex items-center justify-center shadow-sm"
                 style="background: linear-gradient(135deg, #3b82f6, #60a5fa);">
                <i class="fas fa-exchange-alt text-white text-2xl"></i>
            </div>
            <div>
                <h2 class="text-2xl font-bold text-gray-900">ETL</h2>
                <p class="chapter-subtitle">Monitor data pipeline jobs and runs</p>
            </div>
        </div>
        <span class="text-xs bg-gray-100 text-gray-600 px-3 py-1 rounded-full">
            <i class="fas fa-calendar mr-1"></i>Last 30 days
        </span>
    </div>

    <!-- Loading State -->
    <div id="etlChapterLoading" class="model-dashboard-etl-loading">
        <i class="fas fa-spinner fa-spin text-2xl text-gray-400 mr-3"></i>
        <span class="text-gray-500">Loading ETL data...</span>
    </div>

    <!-- Empty State -->
    <div id="etlChapterEmpty" class="model-dashboard-etl-empty hidden">
        <i class="fas fa-exchange-alt"></i>
        <p class="model-dashboard-etl-empty-title">No ETL jobs configured</p>
        <p class="model-dashboard-etl-empty-text">Configure ETL jobs on the ETL page to see data here.</p>
    </div>

    <!-- Content -->
    <div id="etlChapterContent" class="hidden">
        <!-- KPI Row - uses etl-kpi-row from cards.css -->
        <div id="etlChapterKpiRow" class="etl-kpi-row"></div>

        <!-- Row 2: Scheduled Jobs (35%) + Bubble Chart (65%) - uses etl-dashboard-row-2 from cards.css -->
        <div id="etlChapterRow2" class="etl-dashboard-row-2">
            <div id="etlScheduledSection" class="etl-scheduled-section"></div>
            <div id="etlChartSection" class="etl-chart-section"></div>
        </div>
    </div>
</div>

<!-- Experiment View Modal (Reusable Component) -->
{% include 'includes/_exp_view_modal.html' %}
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="{% static 'js/pipeline_dag.js' %}?v=2"></script>
<script src="{% static 'js/exp_view_modal.js' %}?v=4"></script>
<script src="{% static 'js/schedule_calendar.js' %}"></script>
<script src="{% static 'js/model_dashboard_endpoints.js' %}?v=2"></script>
<script src="{% static 'js/model_dashboard_models.js' %}?v=1"></script>
<script src="{% static 'js/model_dashboard_experiments.js' %}?v=3"></script>
<script src="{% static 'js/model_dashboard_configs.js' %}?v=1"></script>
<script src="{% static 'js/model_dashboard_etl.js' %}?v=5"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Configure ExpViewModal for model/experiment viewing
    ExpViewModal.configure({
        showTabs: ['overview', 'versions', 'artifacts', 'deployment', 'lineage'],
        onClose: function() {
            ModelDashboardModels.refresh();
            ModelDashboardExperiments.refresh();
        },
        onUpdate: function(data) {
            ModelDashboardModels.refresh();
            ModelDashboardExperiments.refresh();
        }
    });

    // Initialize and load all chapters
    ModelDashboardEndpoints.init();
    ModelDashboardEndpoints.load();
    ModelDashboardModels.init();
    ModelDashboardModels.load();
    ModelDashboardExperiments.init();
    ModelDashboardExperiments.load();
    ModelDashboardConfigs.init();
    ModelDashboardConfigs.load();
    ModelDashboardEtl.init();
    ModelDashboardEtl.load();
});
</script>
{% endblock %}
